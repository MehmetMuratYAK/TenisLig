<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tenis Ligi</title>
    <link rel="stylesheet" href="style.css">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
</head>
<body>

    <div id="auth-screen">
        <h2>Tenis Ligi GiriÅŸ</h2>

        <div id="register-fields" style="display: none;">
            <div class="profile-upload-container">
                <img id="profile-preview" src="https://via.placeholder.com/100" alt="Profil">
                <label for="profile-photo" class="upload-label">+ FotoÄŸraf Ekle</label>
                <input type="file" id="profile-photo" accept="image/*" style="display:none;">
            </div>

            <input type="text" id="full-name" placeholder="Ad Soyad">
            
            <select id="court-preference">
                <option value="" disabled selected>Favori Kort Tipi SeÃ§in</option>
                <option value="Toprak">Toprak ğŸ§±</option>
                <option value="Sert">Sert ğŸŸ¦</option>
                <option value="Ã‡im">Ã‡im ğŸŒ±</option>
                <option value="Her Ä°kisi">Farketmez ğŸ¤·â€â™‚ï¸</option>
            </select>

            <input type="tel" id="phone-number" placeholder="Telefon (05XX...)">
        </div>
        
        <input type="email" id="email" placeholder="E-posta">
        <input type="password" id="password" placeholder="Åifre">
        
        <button id="login-btn">GiriÅŸ Yap</button>
        <button id="register-btn" style="display:none;">KayÄ±t Ol</button>
        
        <p id="toggle-auth-mode">HesabÄ±n yok mu? KayÄ±t Ol</p>
        <p id="auth-error"></p>
    </div>

    <div id="main-app" style="display: none;">
        
        <div class="header-container">
            <h1>ğŸ¾ Tenis Ligi</h1>
        </div>

        <div id="tab-lobby" class="tab-section active-section">
            <h3>Lobi ğŸ </h3>
            
            <div class="lobby-card" style="background: linear-gradient(to right, #ffffff, #f8f9fa); border-left: 4px solid #6f42c1;">
                <h4 style="color:#6f42c1;">ğŸ“¢ Ligden Haberler & Dedikodular</h4>
                <p style="font-size:0.8em; color:#888; margin-bottom:10px;">Yapay zeka ligi izliyor ve yorumluyor... ğŸ¤–</p>
                
                <div id="lobby-announcements-container" class="lobby-scroll-list" style="max-height: 250px;">
                    <p style="text-align:center; color:#777;">Haberler yÃ¼kleniyor...</p>
                </div>
            </div>
            
            <div style="margin-top: 20px; display:flex; justify-content:space-between; align-items:center; margin-bottom: 5px;">
                <h4 style="margin:0; color: #2c3e50; border:none; padding:0;">ğŸ“¢ AÃ§Ä±k MaÃ§ Ä°lanlarÄ±</h4>
                <span style="font-size:0.7em; color:#777;">(KaydÄ±r â†•)</span>
            </div>
            
            <div id="lobby-requests-container" class="lobby-scroll-list">
                <p style="text-align:center; color:#777; padding:10px;">Ä°lanlar yÃ¼kleniyor...</p>
            </div>

            <div style="margin-top: 20px; display:flex; justify-content:space-between; align-items:center; margin-bottom: 5px;">
                <h4 style="margin:0; color: #2c3e50; border:none; padding:0;">ğŸ“… YaklaÅŸan MaÃ§lar</h4>
                <span style="font-size:0.7em; color:#777;">(KaydÄ±r â†•)</span>
            </div>
            
            <div id="lobby-scheduled-container" class="lobby-scroll-list">
                <p style="text-align:center; color:#777; padding:10px;">MaÃ§lar yÃ¼kleniyor...</p>
            </div>

            <div class="lobby-card" style="background:#e8f5e9; border-color:#c8e6c9; margin-top: 25px;">
                <p style="color:#2e7d32; margin:0; text-align:center; font-size: 0.85em;">
                    â„¹ï¸ <strong>Ä°pucu:</strong> AÃ§Ä±k ilanlardan birini kabul ederek hemen maÃ§a baÅŸlayabilirsin. Kendi ilanÄ±nÄ± oluÅŸturmak iÃ§in "Meydan" sekmesine gitmelisin.
                </p>
            </div>
        </div>

        <div id="tab-rankings" class="tab-section" style="display: none;">
            <h3>Lig SÄ±ralamasÄ± ğŸ†</h3>
            <div id="leaderboard">
            </div>
            
            <div class="lobby-card" style="background:#fff3e0; border-color:#ffe0b2; margin-top: 15px;">
                <p style="color:#ef6c00; margin:0; text-align:center; font-size: 0.85em;">
                    â„¹ï¸ SÄ±ralama, onaylanmÄ±ÅŸ maÃ§ sonuÃ§larÄ±na gÃ¶re puanlar hesaplandÄ±ktan sonra otomatik olarak gÃ¼ncellenir.
                </p>
            </div>
        </div>

        <div id="tab-challenge" class="tab-section" style="display: none;">
            <h3>Meydan Oku âš”ï¸</h3>
            
            <div class="challenge-actions" style="margin-top: 10px;">
                <button id="btn-show-create-ad" class="btn-purple">ğŸ“¢ Herkese AÃ§Ä±k MaÃ§ Talebi OluÅŸtur</button>
                <button id="btn-show-specific-challenge" class="btn-accept">ğŸ‘¤ Oyuncuya Ã–zel MaÃ§ Talebi OluÅŸtur</button>
            </div>

            <div id="create-ad-form" style="display:none; background:#f9f9f9; padding:15px; border-radius:10px; margin-top:10px; border:1px solid #eee;">
                <h4>Yeni MaÃ§ Talebi OluÅŸtur</h4>
                <p style="font-size:0.85em; color:#666; margin-bottom:10px;">Bu talebi ligdeki herkes gÃ¶rebilir ve kabul edebilir.</p>
                
                <select id="ad-match-type">
                    <option value="Dostluk">Dostluk MaÃ§Ä±</option>
                    <option value="Meydan Okuma">PuanlÄ± Meydan Okuma</option>
                </select>
                <input type="number" id="ad-wager-points" placeholder="Bahis PuanÄ± (Min 50)" min="50" style="display:none;">
                
                <div style="display:flex; gap:10px;">
                    <button id="submit-ad-btn" class="btn-save">YayÄ±nla</button>
                    <button onclick="document.getElementById('create-ad-form').style.display='none';" class="btn-reject" style="background:#ccc; color:#333;">Ä°ptal</button>
                </div>
            </div>

            <div id="challenge-form" style="display:none; background:#f9f9f9; padding:15px; border-radius:10px; margin-top:10px; border:1px solid #eee;">
                <h4>Ã–zel MaÃ§ Talebi</h4>
                <select id="opponent-select">
                    <option value="">Rakip SeÃ§in</option>
                </select>

                <select id="match-type-select">
                    <option value="Dostluk">Dostluk MaÃ§Ä±</option>
                    <option value="Meydan Okuma">PuanlÄ± Meydan Okuma</option>
                </select>

                <input type="number" id="wager-points" placeholder="Bahis PuanÄ± (Min 50)" min="50" style="display:none;">

                <div style="display:flex; gap:10px;">
                    <button id="submit-challenge-btn" class="btn-save">Teklifi GÃ¶nder</button>
                    <button onclick="document.getElementById('challenge-form').style.display='none';" class="btn-reject" style="background:#ccc; color:#333;">Ä°ptal</button>
                </div>
                <p id="challenge-message"></p>
            </div>

            <div class="lobby-card" style="background:#e3f2fd; border-color:#90caf9; margin-top: 25px;">
                <p style="color:#0d47a1; margin:0; text-align:center; font-size: 0.85em;">
                    â„¹ï¸ <strong>Bilgi:</strong> AÃ§Ä±k maÃ§ ilanlarÄ±nÄ± artÄ±k <strong>Lobi</strong> ekranÄ±nda gÃ¶rebilirsin. 
                    Buradan sadece yeni ilan oluÅŸturabilirsin.
                </p>
            </div>
        </div>

        <div id="tab-fixture" class="tab-section" style="display: none;">
            <h3>Lig FikstÃ¼rÃ¼ ğŸ“…</h3>
            
            <div id="program-content" style="display:block;">
                <div id="filters-container">
                    <div class="filter-row">
                        <input type="date" id="filter-date-start" placeholder="BaÅŸlangÄ±Ã§">
                        <input type="date" id="filter-date-end" placeholder="BitiÅŸ">
                    </div>
                    <div class="filter-row">
                        <select id="filter-court"><option value="">TÃ¼m Kortlar</option></select>
                        <select id="filter-player"><option value="">TÃ¼m Oyuncular</option></select>
                    </div>
                    <div class="filter-row">
                        <select id="filter-status" style="width: 100%;">
                            <option value="">TÃ¼m Durumlar</option>
                            <option value="Bekliyor">YanÄ±t Bekleniyor â³</option>
                            <option value="HazÄ±r">OynanÄ±yor / HazÄ±r ğŸ¾</option>
                            <option value="SonuÃ§_Bekleniyor">SonuÃ§ OnayÄ± Bekliyor ğŸ“</option>
                            <option value="TamamlandÄ±">Bitti âœ…</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button id="apply-filters-btn" class="btn-filter-apply">Filtrele ğŸ”</button>
                        <button id="clear-filters-btn" class="btn-filter-clear">Temizle âŒ</button>
                    </div>
                </div>

                <div id="program-list-container">
                    <p style="text-align:center; color:#777;">YÃ¼kleniyor...</p>
                </div>
            </div>

            <div class="lobby-card" style="background:#f3e5f5; border-color:#e1bee7; margin-top: 15px;">
                <p style="color:#7b1fa2; margin:0; text-align:center; font-size: 0.85em;">
                    â„¹ï¸ GeÃ§miÅŸ maÃ§ sonuÃ§larÄ±nÄ±, gelecek programÄ± veya belirli bir oyuncunun maÃ§larÄ±nÄ± filtreleyerek buradan inceleyebilirsin.
                </p>
            </div>
        </div>

        <div id="tab-matches" class="tab-section" style="display: none;">
            <h2 id="match-list-title">MaÃ§ AkÄ±ÅŸÄ± ğŸ¾</h2>
            <div id="match-tabs">
                <button class="tab-btn" data-status="pending_to_me">Cevap Bekleyen</button>
                <button class="tab-btn" data-status="pending_from_me">Tekliflerim</button>
                <button class="tab-btn" data-status="active">Aktif</button>
                <button class="tab-btn" data-status="completed">GeÃ§miÅŸ</button>
            </div>
            
            <div id="user-match-list-container">
                <p>LÃ¼tfen bir sekme seÃ§in...</p>
            </div>

            <div class="lobby-card" style="background:#e1f5fe; border-color:#b3e5fc; margin-top: 15px;">
                <p style="color:#0277bd; margin:0; text-align:center; font-size: 0.85em;">
                    â„¹ï¸ <strong>Aktif</strong> sekmesindeki maÃ§larÄ±na girerek maÃ§ gÃ¼nÃ¼/saatini planlayabilir ve maÃ§ bitiminde skorunu girebilirsin.
                </p>
            </div>
        </div>

        <div id="tab-chat" class="tab-section" style="display: none;">
            <h3>Mesajlar ğŸ’¬</h3>
            <div id="my-chats-section" style="display: block; margin-top: 15px;">
                <div id="chat-list-container">
                    <p style="text-align:center; color:#777;">Sohbetler yÃ¼kleniyor...</p>
                </div>
            </div>

            <div class="lobby-card" style="background:#fafafa; border-color:#eee; margin-top: 15px;">
                <p style="color:#666; margin:0; text-align:center; font-size: 0.85em;">
                    â„¹ï¸ Sohbetler Ã¶zeldir. Bir sohbeti temizlemek veya silmek iÃ§in yanÄ±ndaki Ã§Ã¶p kutusu simgesini kullanabilirsin.
                </p>
            </div>
        </div>

        <div id="tab-profile" class="tab-section" style="display: none;">
            <h3>Profilim ğŸ‘¤</h3>

            <div class="my-stats-grid">
                <div class="stat-item"><h4 id="my-stats-points" class="text-green">0</h4><span>Puan</span></div>
                <div class="stat-item"><h4 id="my-stats-matches" class="text-blue">0</h4><span>MaÃ§</span></div>
                <div class="stat-item"><h4 id="my-stats-winrate" class="text-yellow">0%</h4><span>Galibiyet</span></div>
                <div class="stat-item"><h4 id="my-stats-setrate" class="text-purple">0%</h4><span>Set %</span></div>
                <div class="stat-item"><h4 id="my-stats-gamerate" class="text-orange">0%</h4><span>Oyun %</span></div>
            </div>

            <div style="background-color: #fff; padding: 20px; border-radius: 10px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                
                <div class="profile-upload-container">
                    <img id="edit-profile-preview" src="https://via.placeholder.com/100" class="profile-preview-large">
                    <label for="edit-profile-photo" class="upload-label-blue">FotoÄŸrafÄ± DeÄŸiÅŸtir</label>
                    <input type="file" id="edit-profile-photo" accept="image/*" style="display:none;">
                </div>

                <label class="input-label">Ad Soyad:</label>
                <input type="text" id="edit-full-name" placeholder="Ad Soyad">
                
                <label class="input-label">Kort Tercihi:</label>
                <select id="edit-court-preference">
                    <option value="Toprak">Toprak</option>
                    <option value="Sert">Sert</option>
                    <option value="Ã‡im">Ã‡im</option>
                    <option value="Her Ä°kisi">Farketmez</option>
                </select>
                
                <label class="input-label">Telefon:</label>
                <input type="tel" id="edit-phone-number" placeholder="Telefon">

                <label class="input-label">Bildirim Tercihi:</label>
                <select id="edit-notification-preference">
                    <option value="ses">Ses ğŸ”Š</option>
                    <option value="titresim">TitreÅŸim ğŸ“³</option>
                    <option value="sessiz">Ä°stemiyorum ğŸ”•</option>
                </select>
                
                <button id="request-permission-btn" class="btn-purple" style="margin-top:15px;">Bildirim Ä°zni Ä°ste ğŸ””</button>
                <button id="save-profile-btn" class="btn-save-profile">Kaydet ve GÃ¼ncelle</button>
                
                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                
                <button id="logout-btn-profile" style="background-color: #dc3545; margin-top: 5px;">Ã‡Ä±kÄ±ÅŸ Yap ğŸšª</button>
            </div>
        </div>

        <div style="height: 80px;"></div>

        <nav class="bottom-nav">
            <div class="nav-item active" data-target="tab-lobby">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-text">Lobi</span>
            </div>
            <div class="nav-item" data-target="tab-rankings">
                <span class="nav-icon">ğŸ†</span>
                <span class="nav-text">SÄ±ralama</span>
            </div>
            <div class="nav-item" data-target="tab-challenge">
                <span class="nav-icon">âš”ï¸</span>
                <span class="nav-text">Meydan</span>
            </div>
            <div class="nav-item" data-target="tab-matches">
                <span class="nav-icon">ğŸ¾</span>
                <span class="nav-text">MaÃ§larÄ±m</span>
            </div>
             <div class="nav-item" data-target="tab-fixture">
                <span class="nav-icon">ğŸ“…</span>
                <span class="nav-text">FikstÃ¼r</span>
            </div>
            <div class="nav-item" data-target="tab-chat">
                <span class="nav-icon">ğŸ’¬</span>
                <span class="nav-text">Sohbet</span>
            </div>
            <div class="nav-item" data-target="tab-profile">
                <span class="nav-icon">ğŸ‘¤</span>
                <span class="nav-text">Profil</span>
            </div>
        </nav>

        <div id="match-detail-view" style="display: none;">
            <h3>MaÃ§ DetayÄ±</h3>
            <p id="detail-match-info"></p>
            <button id="chat-from-match-btn" class="btn-chat-small" style="display:none;">ğŸ’¬ Rakibe Mesaj At</button>

            <div id="schedule-input-section" style="display:none;">
                <h4>MaÃ§ Planlama ğŸ“…</h4>
                <label class="input-label">Kort SeÃ§imi:</label>
                <select id="match-venue-select"><option value="">Kort SeÃ§iniz</option></select>
                <label class="input-label">Tarih ve Saat:</label>
                <input type="datetime-local" id="match-time-input">
                <button id="save-schedule-btn" class="btn-save-schedule">PlanÄ± Kaydet</button>
            </div>

            <div id="score-input-section" style="display:none;">
                <h4>Set SkorlarÄ± (Ben - Rakip)</h4>
                <div class="score-row"><span>Set 1:</span><input type="number" id="s1-me" class="score-box" placeholder="0" min="0" max="7"> - <input type="number" id="s1-opp" class="score-box" placeholder="0" min="0" max="7"></div>
                <div class="score-row"><span>Set 2:</span><input type="number" id="s2-me" class="score-box" placeholder="0" min="0" max="7"> - <input type="number" id="s2-opp" class="score-box" placeholder="0" min="0" max="7"></div>
                <div class="score-row"><span>Tie-Break:</span><input type="number" id="s3-me" class="score-box" placeholder="0" min="0"> - <input type="number" id="s3-opp" class="score-box" placeholder="0" min="0"></div>
            </div>

            <div id="score-display-section" style="display:none;"></div>
            <select id="winner-select" style="display:none;"><option value="">KazananÄ± SeÃ§in</option></select>
            <div id="action-buttons-container"></div>
            <p id="result-message"></p>
            <button id="back-to-list-btn">Geri DÃ¶n</button>
        </div>

        <div id="player-stats-modal" class="modal">
            <div class="modal-content">
                <span id="close-stats-modal" class="close-modal">&times;</span>
                
                <div class="modal-header-center">
                    <img id="stats-player-photo" src="" class="modal-photo">
                    <h3 id="stats-player-name" style="margin-bottom: 5px;"></h3>
                    <div style="font-size:0.9em; color:#666; margin-bottom:10px;">
                        <span id="stats-total-points" style="font-weight:bold; color:#28a745;"></span> Puan â€¢ 
                        <span id="stats-court-pref"></span>
                    </div>
                    <button id="start-chat-btn" class="btn-chat" style="margin: 0 auto 10px auto;">Mesaj GÃ¶nder ğŸ’¬</button>
                </div>

                <div class="stats-container">
                    
                    <div id="stats-h2h-box" class="h2h-box" style="display:none;">
                        AramÄ±zdaki MaÃ§lar YÃ¼kleniyor...
                    </div>

                    <div class="form-container">
                        <span class="form-title">Son 5 MaÃ§ Formu</span>
                        <div id="stats-form-badges" class="form-badges">
                            </div>
                    </div>

                    <div class="pies-container">
                        <div class="pie-wrapper">
                            <div class="stat-pie" id="pie-match-chart" style="--p:0;">
                                <span id="text-match-rate">0%</span>
                            </div>
                            <span class="pie-label">MaÃ§</span>
                        </div>
                        <div class="pie-wrapper">
                            <div class="stat-pie" id="pie-set-chart" style="--p:0; background: conic-gradient(#007bff var(--p), #e9ecef 0);">
                                <span id="text-set-rate">0%</span>
                            </div>
                            <span class="pie-label">Set</span>
                        </div>
                        <div class="pie-wrapper">
                            <div class="stat-pie" id="pie-game-chart" style="--p:0; background: conic-gradient(#ffc107 var(--p), #e9ecef 0);">
                                <span id="text-game-rate">0%</span>
                            </div>
                            <span class="pie-label">Oyun</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div id="chat-window-modal" class="modal">
            <div class="modal-content chat-content">
                <div class="chat-header">
                    <h3 id="chat-recipient-name">Sohbet</h3>
                    <div>
                        <button id="clear-chat-btn" style="background: none; border: none; color: #dc3545; font-size: 0.8em; margin-right: 10px; cursor: pointer;">Temizle ğŸ—‘ï¸</button>
                        <span id="close-chat-window" class="close-modal-x" style="font-size:24px; cursor: pointer;">&times;</span>
                    </div>
                </div>
                <div id="chat-messages" class="chat-messages"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="Mesaj yaz...">
                    <button id="send-message-btn">GÃ¶nder</button>
                </div>
            </div>
        </div>

        <div id="notification-container"></div>
        
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-messaging-compat.js"></script>
    
    <script src="app.js"></script>
    
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // './sw.js' olarak kaydediyoruz (Nokta Ã¶nemli)
                navigator.serviceWorker.register('./sw.js').then(function(registration) {
                    console.log('SW BaÅŸarÄ±lÄ±:', registration.scope);
                }, function(err) { console.log('SW HatasÄ±:', err); });
            });
        }
    </script>
</body>
</html>